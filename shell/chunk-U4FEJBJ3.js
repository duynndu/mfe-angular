var _=Object.defineProperty,H=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var E=(e,t,o)=>t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,l=(e,t)=>{for(var o in t||={})S.call(t,o)&&E(e,o,t[o]);if(w)for(var o of w(t))W.call(t,o)&&E(e,o,t[o]);return e},f=(e,t)=>H(e,O(t));var m=(e,t,o)=>new Promise((r,n)=>{var i=a=>{try{c(o.next(a))}catch(d){n(d)}},s=a=>{try{c(o.throw(a))}catch(d){n(d)}},c=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,s);c((o=o.apply(e,t)).next())});function T(e,t){return{imports:l(l({},e.imports),t.imports),scopes:l(l({},e.scopes),t.scopes)}}var x="__NATIVE_FEDERATION__",M=globalThis;M[x]??={externals:new Map,remoteNamesToRemote:new Map,baseUrlToRemoteNames:new Map};var y=M[x],R=y.externals;function v(e){return`${e.packageName}@${e.version}`}function q(e){let t=v(e);return R.get(t)}function N(e,t){let o=v(e);R.set(o,t)}function h(e){let t=e.split("/");return t.pop(),t.join("/")}function p(e,t){for(;e.endsWith("/");)e=e.substring(0,e.length-1);return t.startsWith("./")&&(t=t.substring(2,t.length)),`${e}/${t}`}var F=y.remoteNamesToRemote,g=y.baseUrlToRemoteNames;function K(e,t){F.set(e,t),g.set(t.baseUrl,e)}function U(e){return g.get(e)}function A(e){return g.has(e)}function D(e){return F.get(e)}function I(e){document.head.appendChild(Object.assign(document.createElement("script"),{type:"importmap-shim",innerHTML:JSON.stringify(e)}))}function P(){return m(this,arguments,function*(e={},t){let o=t?.cacheTag?`?t=${t.cacheTag}`:"",r=typeof e=="string"?yield V(e+o):e,n="./remoteEntry.json"+o,i=yield j(n),s=yield G(i),c=yield B(r,l({throwIfRemoteNotFound:!1},t)),a=T(s,c);return I(a),a})}function V(e){return m(this,null,function*(){return yield fetch(e).then(t=>t.json())})}function B(o){return m(this,arguments,function*(e,t={throwIfRemoteNotFound:!1}){let r=Object.keys(e).map(s=>m(null,null,function*(){try{let c=e[s];if(t.cacheTag){let a=e[s].includes("?")?"&":"?";c+=`${a}t=${t.cacheTag}`}return yield $(c,s)}catch{let a=`Error loading remote entry for ${s} from file ${e[s]}`;if(t.throwIfRemoteNotFound)throw new Error(a);return console.error(a),null}}));return(yield Promise.all(r)).reduce((s,c)=>c?T(s,c):s,{imports:{},scopes:{}})})}function $(e,t){return m(this,null,function*(){let o=h(e),r=yield j(e);t||(t=r.name);let n=z(r,t,o);return K(t,f(l({},r),{baseUrl:o})),n})}function z(e,t,o){let r=Y(e,t,o),n=J(e,o);return{imports:r,scopes:n}}function j(e){return m(this,null,function*(){return yield fetch(e).then(o=>o.json())})}function J(e,t){let o={},r={};for(let n of e.shared){let i=q(n)??p(t,n.outFileName);N(n,i),r[n.packageName]=i}return o[t+"/"]=r,o}function Y(e,t,o){let r={};for(let n of e.exposes){let i=p(t,n.key),s=p(o,n.outFileName);r[i]=s}return r}function G(e,t="./"){return m(this,null,function*(){let o=e.shared.reduce((r,n)=>f(l({},r),{[n.packageName]:t+n.outFileName}),{});for(let r of e.shared)N(r,t+r.outFileName);return{imports:o,scopes:{}}})}function k(e,t){return m(this,null,function*(){let o=ee(e,t);yield Z(o);let r=X(o),n=D(r),i=o.fallback,s=n?"":"unknown remote "+r;if(!n&&!i)throw new Error(s);if(!n)return b(s),Promise.resolve(i);let c=n.exposes.find(u=>u.key===o.exposedModule),a=c?"":`Unknown exposed module ${o.exposedModule} in remote ${r}`;if(!c&&!i)throw new Error(a);if(!c)return b(a),Promise.resolve(i);let d=p(n.baseUrl,c.outFileName);try{return Q(d)}catch(u){if(i)return console.error("error loading remote module",u),i;throw u}})}function Q(e){return typeof importShim<"u"?importShim(e):import(e)}function X(e){let t;if(e.remoteName)t=e.remoteName;else if(e.remoteEntry){let o=h(e.remoteEntry);t=U(o)}else throw new Error("unexpcted arguments: Please pass remoteName or remoteEntry");if(!t)throw new Error("unknown remoteName "+t);return t}function Z(e){return m(this,null,function*(){if(e.remoteEntry&&!A(h(e.remoteEntry))){let t=yield $(e.remoteEntry);I(t)}})}function ee(e,t){let o;if(typeof e=="string"&&t)o={remoteName:e,exposedModule:t};else if(typeof e=="object"&&!t)o=e;else throw new Error("unexpected arguments: please pass options or a remoteName/exposedModule-pair");return o}function b(e){typeof window<"u"&&console.error(e)}var L={};function le(e,t){let o;if(typeof e=="string"){if(!t)throw new Error("exposedModule is required when using string parameters");o={remoteName:e,exposedModule:t}}else o=e;return te(o)}function te(r){return m(this,arguments,function*({remoteName:e,remoteEntry:t,exposedModule:o}){if(!t&&!e)throw new Error("You must provide either remoteEntry or remoteName to load the remote module.");let n=t??L[e];if(!n)throw new Error(`Unable to resolve remote module. remoteName: ${e}, remoteEntry: ${t}. Did you call initFederation first?`);if(n.endsWith("remoteEntry.json"))return k({remoteName:e,remoteEntry:n,exposedModule:o});if(n.endsWith("remoteEntry.js"))try{let i=yield import(n);yield i.init?.({});let s=yield i.get(o);if(!s)throw new Error(`Exposed module '${o}' not found in remote`);return s()}catch(i){throw new Error(`Failed to load remote module '${o}' from ${n}: ${i.message}`)}throw new Error(`Unsupported remote entry format: ${n}`)})}function de(e){return m(this,null,function*(){typeof e=="string"?yield oe(e):yield C(e)})}function oe(e){return m(this,null,function*(){try{let t=yield fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let o=yield t.json();if(!o||typeof o!="object")throw new Error('Invalid manifest structure: missing "remotes" object');yield C(o)}catch(t){throw console.error(`Failed to load federation manifest from ${e}:`,t),t}})}function C(e){return m(this,null,function*(){L=l({},e);let t=Object.fromEntries(Object.entries(e).filter(([r,n])=>n.endsWith("remoteEntry.js"))),o=Object.fromEntries(Object.entries(e).filter(([r,n])=>n.endsWith("remoteEntry.json")));yield P(o)})}export{m as a,le as b,de as c};
